{extend name="/common/default" /}
{block name="main"}
<div class="row">
    <div class="col-xl-12">
        <!-- Bootstrap Contact -->
        <div class="block block-themed">
            <div class="block-header bg-info">
                <h3 class="block-title">{$title}</h3>
                <div class="block-options">
                    <button type="button" class="btn-block-option" data-toggle="block-option" data-action="state_toggle"
                            data-action-mode="demo">
                        <i class="si si-refresh"></i>
                    </button>
                    <button type="button" class="btn-block-option" data-toggle="block-option"
                            data-action="content_toggle"><i class="si si-arrow-up"></i></button>
                </div>
            </div>
            <div class="block-content">
                <form action="be_forms_premade.html" method="post" onsubmit="return false;">
                    <div class="form-group row">
                        <div class="col-12">
                            <label for="contact1-firstname">对接ID</label>
                            <input type="text" class="form-control" readonly
                                   id="contact1-firstname" value="{$uinfo['uid']}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-12">
                            <label>对接Token</label>
                            <input type="text" data-clipboard-text="{$uinfo['docking']}" id="docking"
                                   class="form-control" readonly
                                   placeholder="第一次使用请点击获取Token" value="{$uinfo['docking']}">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-12" style="text-align:center;">
                            {if $uinfo['docking']}
                            <button id="submit" type="submit" class="btn btn-alt-info">
                                <i class="fa fa-send mr-5"></i> 重置Token
                            </button>
                            {else/}
                            <button id="submit" type="submit" class="btn btn-alt-info">
                                <i class="fa fa-send mr-5"></i> 获取Token
                            </button>
                            {/if}
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="footjs"}
<script src="//cdn.bootcss.com/clipboard.js/1.7.1/clipboard.js"></script>
<script>
    //提交表单
    $("#submit").click(function () {
        layer.confirm('确定重置么？', {
            btn: ['确定', '取消'] //按钮
        }, function () {
            layer.load(2, {shade: [0.1, '#fff']});
            $.ajax({
                url: "/{:USER_DIR}/do_token",
                type: 'post',
                dataType: 'json',
                success: function (res) {
                    layer.closeAll();
                    if (res.code == 1) {
                        layer.alert(res.msg, {icon: 6});
                        $('#submit').html('<i class="fa fa-send mr-5"></i> 重置Token');
                        $('#docking').val(res.docking);
                    } else {
                        layer.msg(res.msg, {icon: 5});
                    }
                },
                timeout: 10000,
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    layer.closeAll();
                    if (textStatus == "timeout") {
                        layer.msg('请求超时！');
                    } else {
                        layer.msg('服务器错误！');
                    }
                }
            });
        });
    });
</script>
<script>
    var clipboard = new Clipboard("#docking");
    clipboard.on("success", function (e) {
        layer.msg("复制成功")
    });
    clipboard.on("error", function (e) {
        layer.msg("复制失败，请长按链接后手动复制")
    });
</script>
{/block}