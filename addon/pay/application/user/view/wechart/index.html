{extend name='common/default'/}
{block name="main"}
<div class="row">
    <div class="col-md-12">
        <div class="block block-themed block-rounded block-shadow">
            <div class="block-header block-header-default bg-gd-sea">
                <h3 class="block-title">{$title}（微信自动审核，上传资料直达微信，本站无留存）</h3>
                <div class="block-options">
                    <button type="button" class="btn-block-option">
                        <i class="si si-wrench"></i>
                    </button>
                </div>
            </div>
            <div class="block-content">
                <form>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">费率</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" placeholder="0.38%    微信官方费率不可修改" disabled>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">身份证姓名</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="id_card_name" placeholder="请输入身份证姓名">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">身份证号码</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="id_card_number" placeholder="请输入身份证号码">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">身份证有效期</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="id_card_valid_time" placeholder="请输入身份证有效期">
                            <div class="form-text text-muted">格式：2018-01-01/2020-01-01。如果长期的话就写长期，如：2019-01-01/长期</div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">身份证人像面</label>
                        <div class="col-md-12">
                            <div class="input-group">
                                <input type="text" class="form-control input-pill input-solid" name="id_card_copy"
                                       id="id_card_copy">
                                <input type="file" style="display:none" id="id_card_copy_file"
                                       name="id_card_copy_file" accept="image/*"/>
                                <button type="button" class="btn btn-success btn-sm" id="upload_id_card_copy"
                                        onclick="id_card_copy_file.click();">图片上传
                                </button>
                            </div>
                            <div class="form-text text-muted">图片大小不超过2MB</div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">身份证国徽面</label>
                        <div class="col-md-12">
                            <div class="input-group">
                                <input type="text" class="form-control input-pill input-solid"
                                       id="id_card_national" name="id_card_national">
                                <input type="file" style="display:none" id="id_card_national_file"
                                       name="id_card_national_file" accept="image/*"/>
                                <button type="button" class="btn btn-success btn-sm" id="upload_id_card_national"
                                        onclick="id_card_national_file.click();">图片上传
                                </button>
                            </div>
                            <div class="form-text text-muted">图片大小不超过2MB</div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">持卡人姓名</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="account_name" placeholder="请输入持卡人姓名">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">银行账号</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="account_number" placeholder="请输入银行账号">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">请选择开户行</label>
                        <div class="col-md-12">
                            <select name="account_bank" class="form-control">
                                <option value="工商银行">工商银行</option>
                                <option value="交通银行">交通银行</option>
                                <option value="招商银行">招商银行</option>
                                <option value="民生银行">民生银行</option>
                                <option value="中信银行">中信银行</option>
                                <option value="浦发银行">浦发银行</option>
                                <option value="兴业银行">兴业银行</option>
                                <option value="光大银行">光大银行</option>
                                <option value="广发银行">广发银行</option>
                                <option value="平安银行">平安银行</option>
                                <option value="北京银行">北京银行</option>
                                <option value="华夏银行">华夏银行</option>
                                <option value="农业银行">农业银行</option>
                                <option value="建设银行">建设银行</option>
                                <option value="邮政储蓄银行">邮政储蓄银行</option>
                                <option value="中国银行">中国银行</option>
                                <option value="宁波银行">宁波银行</option>
                                <option value="其他银行">其他银行</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">开户银行全称（含支行）</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="bank_name" placeholder="请输入开户银行全称">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">开户银行省市（搜索框内输入,如：长沙市）</label>
                        <div class="col-md-12">
                            <select class="form-control select2 ss" name="bank_address_code"></select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">门店名称</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="store_name" placeholder="请输入门店名称">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">门店省市（搜索框内输入,如：长沙市）</label>
                        <div class="col-md-12">
                            <select class="form-control select2 ss" name="store_address_code"></select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">门店街道地址</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="store_street" placeholder="请输入门店街道地址">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">门店门口照片</label>
                        <div class="col-md-12">
                            <div class="input-group">
                                <input type="text" class="form-control input-pill input-solid"
                                       id="store_entrance_pic" name="store_entrance_pic">
                                <input type="file" style="display:none" id="store_entrance_pic_file"
                                       name="store_entrance_pic_file" accept="image/*"/>
                                <button type="button" class="btn btn-success btn-sm" id="upload_store_entrance_pic"
                                        onclick="store_entrance_pic_file.click();">图片上传
                                </button>
                            </div>
                            <div class="form-text text-muted">图片大小不超过2MB</div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">店内环境照片</label>
                        <div class="col-md-12">
                            <div class="input-group">
                                <input type="text" class="form-control input-pill input-solid"
                                       id="indoor_pic" name="indoor_pic">
                                <input type="file" style="display:none" id="indoor_pic_file"
                                       name="indoor_pic_file" accept="image/*"/>
                                <button type="button" class="btn btn-success btn-sm" id="upload_indoor_pic"
                                        onclick="indoor_pic_file.click();">图片上传
                                </button>
                            </div>
                            <div class="form-text text-muted">图片大小不超过2MB</div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">商户简称</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="merchant_shortname" placeholder="请输入商户简称">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">客服电话</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="service_phone" placeholder="请输入客服电话">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">售卖商品/提供服务描述</label>
                        <div class="col-md-12">
                            <select name="product_desc" class="form-control">
                                <option value="餐饮">餐饮</option>
                                <option value="线下零售">线下零售</option>
                                <option value="居民生活服务">居民生活服务</option>
                                <option value="休闲娱乐">休闲娱乐</option>
                                <option value="交通出行">交通出行</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">联系人姓名</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="contact" placeholder="请输入联系人姓名">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">联系人电话</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="contact_phone" placeholder="请输入联系人电话">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12" for="example-text-input">联系人邮箱</label>
                        <div class="col-md-12">
                            <input type="text" class="form-control" name="contact_email" placeholder="请输入联系人邮箱">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-12">
                            <button type="button" id="submit" class="btn btn-alt-primary">立即提交</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="footjs"}
<link rel="stylesheet" href="//cdn.bootcss.com/select2/4.0.8/css/select2.min.css">
<script src="//cdn.bootcss.com/select2/4.0.8/js/select2.full.min.js"></script>
<script>
    layer.alert('申请入驻前请确定您已经仔细阅读<a href="https://pay.weixin.qq.com/index.php/public/apply_sign/protocol_v2" target="_blank">《微信支付服务协议》</a>', {icon: 6,btn: ['<font color="white">去阅读</font>','已读']},function () {
        window.open("https://pay.weixin.qq.com/index.php/public/apply_sign/protocol_v2");
    });
    $('#submit').click(function () {
        var cont = $("input,select").serialize();
        layer.load(2, {shade: [0.1, '#fff']});
        $.ajax({
            type: "POST",
            url: "{:url('/user/do_wechart_add')}",
            data: cont,
            dataType: 'json',
            success: function (data) {
                layer.closeAll();
                if (data.code == 1) {
                    layer.alert(data.msg, {icon: 6}, function () {
                        window.location.href = "{:url('/user/wechart')}";
                    });
                } else {
                    layer.alert(data.msg, {icon: 5});
                }
            },
            timeout: 10000,
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                layer.closeAll();
                if (textStatus == "timeout") {
                    layer.msg('请求超时！');
                } else {
                    layer.msg('服务器错误！');
                }
            }
        });
    });

    $(function () {
        $(".ss").select2({
            ajax: {
                url: 'wechart_citycode',
                dataType: 'json',
                delay: 252
            }
        });
    });

    $('#id_card_copy_file').change(function (event) {
        layer.msg("上传中，请稍等...", {
            icon: 16,
            shade: 0.1,
            time: false
        });
        var formData = new FormData();
        formData.append('fileupload', $('#id_card_copy_file').get(0).files[0]);
        $.ajax({
            url: "wechart_upload",
            type: "post",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            async: true,
            dataType: "json",
            success: function (data) {
                layer.closeAll();
                layer.msg("上传完成");
                if (data.code == 1) {
                    $('#id_card_copy').attr('value', data.media_id);
                    $('#upload_id_card_copy').attr('disabled', 'disabled');
                    $('#id_card_copy_file').remove();
                } else {
                    layer.closeAll();
                    $('#upload_id_card_copy').attr('disabled', 'disabled');
                    layer.alert(data.msg, {icon: 5}, function () {
                        window.location.href = "{:url('/user/wechart_add')}";
                    });
                }
            }
        });
    });

    $('#id_card_national_file').change(function (event) {
        layer.msg("上传中，请稍等...", {
            icon: 16,
            shade: 0.1,
            time: false
        });
        var formData = new FormData();
        formData.append('fileupload', $('#id_card_national_file').get(0).files[0]);
        $.ajax({
            url: "wechart_upload",
            type: "post",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            async: true,
            dataType: "json",
            success: function (data) {
                layer.closeAll();
                layer.msg("上传完成");
                if (data.code == 1) {
                    $('#id_card_national').attr('value', data.media_id);
                    $('#upload_id_card_national').attr('disabled', 'disabled');
                    $('#id_card_national_file').remove();
                } else {
                    layer.closeAll();
                    $('#upload_id_card_national').attr('disabled', 'disabled');
                    layer.alert(data.msg, {icon: 5}, function () {
                        window.location.href = "{:url('/user/wechart_add')}";
                    });
                }
            }
        });
    });

    $('#store_entrance_pic_file').change(function (event) {
        layer.msg("上传中，请稍等...", {
            icon: 16,
            shade: 0.1,
            time: false
        });
        var formData = new FormData();
        formData.append('fileupload', $('#store_entrance_pic_file').get(0).files[0]);
        $.ajax({
            url: "wechart_upload",
            type: "post",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            async: true,
            dataType: "json",
            success: function (data) {
                layer.closeAll();
                layer.msg("上传完成");
                if (data.code == 1) {
                    $('#store_entrance_pic').attr('value', data.media_id);
                    $('#upload_store_entrance_pic').attr('disabled', 'disabled');
                    $('#store_entrance_pic_file').remove();
                } else {
                    layer.closeAll();
                    $('#upload_store_entrance_pic').attr('disabled', 'disabled');
                    layer.alert(data.msg, {icon: 5}, function () {
                        window.location.href = "{:url('/user/wechart_add')}";
                    });
                }
            }
        });
    });

    $('#indoor_pic_file').change(function (event) {
        layer.msg("上传中，请稍等...", {
            icon: 16,
            shade: 0.1,
            time: false
        });
        var formData = new FormData();
        formData.append('fileupload', $('#indoor_pic_file').get(0).files[0]);
        $.ajax({
            url: "wechart_upload",
            type: "post",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            async: true,
            dataType: "json",
            success: function (data) {
                layer.closeAll();
                layer.msg("上传完成");
                if (data.code == 1) {
                    $('#indoor_pic').attr('value', data.media_id);
                    $('#upload_indoor_pic').attr('disabled', 'disabled');
                    $('#indoor_pic_file').remove();
                } else {
                    layer.closeAll();
                    $('#upload_indoor_pic').attr('disabled', 'disabled');
                    layer.alert(data.msg, {icon: 5}, function () {
                        window.location.href = "{:url('/user/wechart_add')}";
                    });
                }
            }
        });
    });
</script>
{/block}